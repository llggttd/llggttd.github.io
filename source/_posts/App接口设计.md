---
title: App接口设计
date: 2017-05-26 11:44:56
updated: 2017-05-26 11:44:56
categories:
tags:
---


#### 请求结果结构

请求结果为JSON, 结构如下：
```json
{
    "status": 0,
    "result": {},
    "error": "",
}
```

其中：
- status 请求结果状态
- result 请求结果数据
- error  请求结果描述

注意：
1. 服务端保证返回结果为JSON, Context-Type为json类型
2. 同时JSON中的结构要保证与上述结构一致
3. result只可以为{}， 或是[], 不能为null
4. error必须为字符串，可以为空字符串"", 不能为null


#### 返回状态status的定义

status表明了本次请求的状态，客户端在接收到请求结果后要首先判断status的值，针对不同的status采取不同的处理方式。

|status |description    |error  |
|------     |------     |------     |
|0          |请求处理成功 |`"成功"`  |
|1          |缺少必要参数 |`"缺少必要参数"`         |
|2          |后台程序异常 |`"后台程序异常"`         |
|3          |信息提示，当status = 3时，app或html应该把result中的msg提示给用户|`"信息提示"`|
|4          |认证失败，app和html共用此状态|`"认证失败"`|

说明：
- 当返回结果状态为`0`时，说明本次请求后台成功处理，并不表示业务处理成功。具体请求结果要去解析result才能知道。

- 当返回结果状态为`1`时，说明本次请求缺少必要的参数，这种情况一般应该只会在开发过程出现，生产环境的代码都经过测试，不应该出现这种情况。对于客户端，为了更好的用户体验，可以对这种情况进行处理，防止应用闪退等异常出现。

- 当返回结果状态为`2`时，说明本次请求后台发生了异常，如代码中有未捕获的异常、数据库无法连接等。对于这种状态，客户端要转换成友好的提示，如："当前网络出了点小状况，一会儿再来吧..."。

- 当返回结果状态为`3`时，说明本次请求后台需要客户端直接提示信息给用户，通过对话框或Toast等。

- 当返回结果状态为`4`时，说明本次请求没有通过认证。如用户没有相应权限或用户会话过期等，客户端可以对这种情况统一处理，比如跳转到登陆界面，让用户重新登陆等。

**对于status为1、2、3、4这几种情况，客户端在设计时应该针对所有接口做统一的处理，不应该放到接口里单独处理，而且对于这几种情况，不需要去解析返回结果JSON中的`error`和`result`。**

下面看一个例子：
用户输入帐号和密码登陆，后台验证通过后，返回结果状态应该为0；
```json
{
    "status": 0,
    "result": {
        "login": true,
        "uid": "10001",
        "name": "test"
    },
    "error": "成功"
}
```

若后台处理时，发现用户名或密码错误，这时返回的结果状态应该为0，并在result中返回了的具体错误原因；
```json
{
    "status": 0,
    "result": {
        "login": false,
        "msg": "用户名或密码错误"
    },
    "error": "成功"
}

{
    "status": 0,
    "result": {
        "login": false,
        "msg": "用户不存在"
    },
    "error": "成功"
}
```

若后台处理时，发现请求参数中没有password，这时返回的结果状态应该为1。后台如果做的更完善一些，应该返回具体少了哪一些参数，便于开发时定位问题；
```json
{
    "status": 1,
    "result": {},
    "error": "缺少必要参数"
}
```

若后台处理时，在查询数据库时抛出了异常，这时返回的结果状态应该为2，并在result中返回了的具体错误原因；
```json
{
    "status": 2,
    "result": {},
    "error": "后台程序异常"
}
```

若此时后台正在维护，暂停了所有用户的登陆操作，这时返回结果应该为3；
```json
{
    "status": 3,
    "result": {},
    "error": "系统于今天22:00到23:59之前进行升级维护，期间暂停服务，谢谢你的支持..."
}
```
